"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[318],{98318:function(e,t,a){a.d(t,{rT:function(){return f},R7:function(){return I},dd:function(){return C},BD:function(){return N},Yi:function(){return O},z5:function(){return A},Ku:function(){return F},Cf:function(){return E}});var r=a(26306),o=a(34921),i=a(40566),n=a(24004),l=a(45937),s=a.n(l),c=a(14978),u=a(54158),d=a(74246),h=a(56447);let p={WORLD_SIZE:1024e3,EARTH_CIRCUMFERENCE:2*Math.PI*6371008.8,TILE_SIZE:512};class m{update(){let e=this.map.transform;this._camera.aspect=e.width/e.height;let t=e.centerOffset||new h.Vector3,a=0,r=0;this.halfFov=e._fov/2;let o=Math.PI/2+e._pitch,i=Math.cos(Math.PI/2-e._pitch);this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*e.height;let n=1,l=this.worldSize();n=this.mercatorZfromAltitude(1,e.center.lat)*l;let s=e._fov*(.5+e.centerOffset.y/e.height),c=e.elevation?e.elevation.getMinElevationBelowMSL()*n:0,u=(e._camera.position[2]*l-c)/Math.cos(e._pitch);a=Math.min(1.01*(Math.sin(s)*u/Math.sin((0,d.uZ)(Math.PI-o-s,.01,Math.PI-.01))*i+u),1/e._horizonShift*u),this.cameraTranslateZ.makeTranslation(0,0,this.cameraToCenterDistance);let p=e.height/50,m=e.height,f=e.width;this._camera.projectionMatrix=function(e,t,a,r){let o=new h.Matrix4,i=1/Math.tan(e/2),n=1/(a-r);return o.elements=[i/t,0,0,0,0,i,0,0,0,0,(r+a)*n,-1,0,0,2*r*a*n,0],o}(e._fov,f/m,Math.max(p*i,p),a),this._camera.projectionMatrix.elements[8]=-(2*t.x)/e.width,this._camera.projectionMatrix.elements[9]=2*t.y/e.height,this._camera.projectionMatrixInverse=this._camera.projectionMatrix.clone().invert();let _=this.calcCameraMatrix(e._pitch,e.angle,void 0,this._camera.matrix.identity());e.elevation&&(_.elements[14]=e._camera.position[2]*l),this._camera.updateMatrixWorld(!0);let v=e.scale*this._worldSizeRatio;this.__tempScaleMat.makeScale(v,v,v);let M=e.point.x,x=e.point.y;this.__tempTranslateMat.makeTranslation(-M,x,0),this.__tempRotateMat.makeRotationZ(Math.PI),this.__tempMatrix4.identity().premultiply(this.__tempRotateMat).premultiply(this.translateCenter).premultiply(this.__tempScaleMat).premultiply(this.__tempTranslateMat),this.world.matrix.copy(this.__tempMatrix4),this.world.updateMatrixWorld(!0)}worldSize(){let e=this.map.transform;return e.tileSize*e.scale}mercatorZfromAltitude(e,t){return e/this.circumferenceAtLatitude(t)}circumferenceAtLatitude(e){return p.EARTH_CIRCUMFERENCE*Math.cos(e*Math.PI/180)}calcCameraMatrix(e,t,a,r){let o=this.map.transform,i=void 0===e?o._pitch:e,n=void 0===t?o.angle:t,l=void 0===a?this.cameraTranslateZ:a;return(null!=r?r:new h.Matrix4).premultiply(l).premultiply(this.__tempRotateMat.makeRotationX(i)).premultiply(this.__tempScaleMat.makeRotationZ(n))}constructor(e,t,a){this.cameraTranslateZ=new h.Matrix4,this.__tempMatrix4=new h.Matrix4,this.__tempScaleMat=new h.Matrix4,this.__tempRotateMat=new h.Matrix4,this.__tempTranslateMat=new h.Matrix4,this.map=e,this._camera=t,this._camera.matrixAutoUpdate=!1,this._camera.matrixWorldAutoUpdate=!1,this.world=a||new h.Group,this.world.position.set(p.WORLD_SIZE/2,p.WORLD_SIZE/2,0),this.world.matrixAutoUpdate=!1,this.world.matrixWorldAutoUpdate=!1,this.translateCenter=new h.Matrix4().makeTranslation(p.WORLD_SIZE/2,-p.WORLD_SIZE/2,0),this._worldSizeRatio=p.TILE_SIZE/p.WORLD_SIZE,this.update()}}let f=(0,c.forwardRef)((e,t)=>{var{children:a,longitude:s,latitude:u,altitude:d,latitudeScale:h=!0}=e,m=(0,i._)(e,["children","longitude","latitude","altitude","latitudeScale"]);let{pos:f,scale:v}=(0,c.useMemo)(()=>{let e=function(e){var t;let a=l.MercatorCoordinate.fromLngLat([e[0],e[1]],e[2]),r=a.x*p.WORLD_SIZE,o=a.y*p.WORLD_SIZE;o=p.WORLD_SIZE-o,r-=p.WORLD_SIZE/2,o-=p.WORLD_SIZE/2;let i=null!==(t=e[2])&&void 0!==t?t:0;return[-r,-o,i*=_(e[1])]}([s,u,d]),t=_(u);return{pos:e,scale:[t,t,t]}},[u,s,d]);return(0,n.jsx)("group",(0,o._)((0,r._)({ref:t,position:f,scale:h?v:void 0,rotation:[0,0,Math.PI]},m),{children:a}))});function _(e){return Math.abs(p.WORLD_SIZE/Math.cos((0,u.Id)((0,u.uZ)(e,-85.051129,85.051129)))/p.EARTH_CIRCUMFERENCE)}f.displayName="Coordinates";var v=a(80515),M=a(30961),x=a(20601),R=a(68427),w=a(70612),g=a(13182);let S={perspective:{fov:50,pitch:45,canRotate:!0},orthographic:{fov:2.2,pitch:0,canRotate:!1}},b=e=>(0,w.Ue)()((0,g.XR)((t,a)=>{function i(){var t,a;let r=new h.Group;return r.name="World Group",r.matrixAutoUpdate=!1,{mapboxMap:null,threeStateRef:null,mapboxLoaded:!1,worldGroup:r,cameraSync:null,projectionMode:"perspective",mapStyle:null!==(t=e.mapStyle)&&void 0!==t?t:"mapbox://styles/mapbox/light-v10",htmlDivRef:null!==(a=e.htmlDivRef)&&void 0!==a?a:null}}return(0,o._)((0,r._)({},i()),{setMapboxMap:e=>t({mapboxMap:e}),setMapStyle:e=>t({mapStyle:e}),setHtmlDivRef:e=>t({htmlDivRef:e}),_setR3Fstate:e=>{t({threeStateRef:e});let r=a()._postSetupTask;null==r||r()},_setMapboxLoaded:e=>{t({mapboxLoaded:e});let r=a()._postSetupTask;null==r||r()},_setWorldGroup:e=>t({worldGroup:e}),setProjectionMode:e=>{var r;let o=a().mapboxMap;if(!o){console.warn("Map not loaded, cannot change projection mode");return}let i=null===(r=a().threeStateRef)||void 0===r?void 0:r.getState();if(!i){console.warn("Three state not loaded, cannot change projection mode");return}o.transform.fov=S[e].fov,i.camera.fov=S[e].fov,S[e].canRotate?(o.setMaxPitch(85),o.touchPitch.enable()):(o.setMaxPitch(0),o.touchPitch.disable()),o.setPitch(S[e].pitch),o.repaint=!0,o.transform._updateCameraOnTerrain(),t({projectionMode:e})},_setCameraSync:e=>t({cameraSync:e}),_postSetupTask:()=>{let r=a().mapboxMap,o=a().threeStateRef;r&&o&&(e.projectionMode&&a().setProjectionMode(e.projectionMode),t({_postSetupTask:null}))},_cleanup:()=>{t(i())},enableMapboxCameraMovement:e=>{let t=a().mapboxMap;if(!t){console.warn("Map not loaded, cannot enable/disable camera movement");return}let r=a().projectionMode;e?(t.dragPan.enable(),t.dragRotate.enable(),t.touchZoomRotate.enable(),S[r].canRotate?(t.setMaxPitch(85),t.touchPitch.enable()):(t.setMaxPitch(0),t.touchPitch.disable())):(t.dragPan.disable(),t.dragRotate.disable(),t.touchZoomRotate.disable(),t.touchPitch.disable())}})})),y=(0,c.createContext)(null);function E(e){let t=function(){let e=(0,c.useContext)(y);if(!e)throw Error("useNomadStoreInstance must be used within a NomadStoreProvider");return e}();return(0,w.oR)(t,e)}function C(e){let{children:t,initialStoreProps:a}=e,r=(0,c.useRef)();if(!r.current){let e=b(a);r.current=e,window.__DEV_GET_ZUSTAND_STORE_MAP=()=>e}return(0,n.jsx)(y.Provider,{value:r.current,children:t})}a(21336);let L={initialViewState:{center:[-122.4194,37.7749],bearing:0,maxPitch:85,maxZoom:26,minPitch:0,minZoom:0,pitch:30,zoom:18},antialias:!1,attributionControl:!1,bearingSnap:1,bounds:void 0,boxZoom:!1,clickTolerance:1,collectResourceTiming:!1,crossSourceCollisions:!0,cooperativeGestures:!1,customAttribution:void 0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,hash:!1,fadeDuration:300,failIfMajorPerformanceCaveat:!1,fitBoundsOptions:void 0,interactive:!0,keyboard:!0,locale:void 0,localFontFamily:void 0,localIdeographFontFamily:void 0,logoPosition:"bottom-left",maxBounds:void 0,maxTileCacheSize:void 0,preserveDrawingBuffer:!1,projection:{name:"mercator",center:[0,0],parallels:[0,0]},pitchWithRotate:!0,refreshExpiredTiles:!0,renderWorldCopies:!0,scrollZoom:!0,style:"mapbox://styles/mapbox/light-v8",testMode:!1,trackResize:!0,transformRequest:void 0,touchZoomRotate:!0,touchPitch:!0,host:"https://api.mapbox.com"};function P(e){let t=(0,c.useRef)(null),a=(0,c.useRef)(),i=(0,c.useRef)(),u=E(e=>e.setMapboxMap);return(0,c.useEffect)(()=>{if(!t.current)return;if(a.current){let t=a.current,{options:r,events:o}=T(e);for(let[e,a]of o)t.on(e,a);return i.current!=r.style&&(t.setStyle(r.style,{diff:!1,localFontFamily:void 0,localIdeographFontFamily:void 0}),i.current=r.style),function(e,t){for(let[o,i]of Object.entries(t)){if("style"===o)continue;let t="".concat(o.slice(0,1).toUpperCase()).concat(o.slice(1)),n="get".concat(t),l="set".concat(t);if(!(n in e))continue;let s=e[n]();if(s!==i){var a,r;if("center"===o&&Math.abs(s.lat-(null!==(a=i.lat)&&void 0!==a?a:i[1]))<=Number.MIN_VALUE&&Math.abs(s.lng-(null!==(r=i.lng)&&void 0!==r?r:i[0]))<=Number.MIN_VALUE||!(l in e))continue;e[l](i)}}}(t,r),()=>{for(let[e,a]of o)t.off(e,a)}}let{options:n,events:c,initialViewState:d}=T((0,r._)({},L,e));n.host&&(s().baseApiUrl=n.host,delete n.host);let h=new l.Map((0,o._)((0,r._)({},n,d),{container:t.current}));for(let[e,t]of(h.uuid=(0,R.Z)(),a.current=h,i.current=n.style,c))h.on(e,t);return u(h),()=>{for(let[e,t]of c)h.off(e,t)}},[e,t,u]),(0,c.useEffect)(()=>{let e;if(!(t.current&&a.current))return;let r=new ResizeObserver(()=>{clearTimeout(e),e=setTimeout(()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.resize()},50)});return r.observe(t.current),()=>{clearTimeout(e),r.disconnect()}},[t,a]),(0,c.useEffect)(()=>()=>{var e;null===(e=a.current)||void 0===e||e.remove(),a.current=void 0,u(null)},[]),(0,n.jsx)("div",{ref:t,style:{width:"100%",height:"100%"}})}function T(e){let t={},a=[],r={};for(let[i,n]of Object.entries(e)){var o;i.startsWith("on")&&i[2]===(null===(o=i[2])||void 0===o?void 0:o.toUpperCase())?a.push([i.slice(2,3).toLowerCase()+i.slice(3),n]):"initialViewState"===i&&"object"==typeof n?r=n:t[i]=n}return{options:t,events:a,initialViewState:r}}let j=e=>{let t=(0,c.useRef)(e);return t.current=e,(0,c.useCallback)(function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return t.current(...a)},[])};function I(e){var{children:t,accessToken:a,host:l,initialViewState:s,className:u,contexts:d=[],mapboxProps:h}=e,p=(0,i._)(e,["children","accessToken","host","initialViewState","className","contexts","mapboxProps"]);let m=(0,c.useRef)(null),f=E(e=>e.htmlDivRef),_=E(e=>e.setHtmlDivRef);(0,c.useEffect)(()=>{(null==f?void 0:f.current)==null&&m.current&&_(m)},[m,f,_]);let M=E(e=>e.mapboxMap),x=E(e=>e.mapboxLoaded),R=E(e=>e.mapStyle),w=E(e=>e.worldGroup),g=E(e=>e._setMapboxLoaded),S=E(e=>e._cleanup),b=(0,v.j)(y,...d);return(0,c.useEffect)(()=>()=>{S()},[S]),(0,n.jsx)("div",{ref:m,className:u,children:(0,n.jsxs)("div",{style:{height:"100%",width:"100%",position:"relative"},children:[(0,n.jsx)(P,(0,r._)({accessToken:a,host:l,style:R,initialViewState:s,antialias:!0,onLoad:e=>{g(!0)},dragPan:{easing:e=>0}},h)),M&&x&&(0,n.jsx)(k,(0,o._)((0,r._)({map:M},p),{children:(0,n.jsx)(b,{children:(0,n.jsx)("primitive",{object:w,children:t})})}))]})})}(0,M.e)(h);let Z="mapboxSyncLayer",D=(e,t)=>{e.style.getOwnLayer(Z)||e.addLayer({id:Z,type:"custom",renderingMode:"3d",render:()=>{let t=e.getCanvas(),{gl:a,advance:r}=M.w.get(t).store.getState();a.resetState(),r(.001*Date.now(),!0),e.triggerRepaint()},prerender:()=>{t.update()}})};function k(e){var{map:t}=e;return!function(e,t,a){var{children:l}=e,s=(0,i._)(e,["children"]);let u=E(e=>e._setCameraSync),d=E(e=>e._setR3Fstate),h=(0,c.useRef)(null),{root:p,store:f}=(0,c.useMemo)(()=>{let e=t.getCanvas(),a=e.getContext("webgl2");h.current&&M.w.get(e)||(h.current=(0,M.b)(e));let i=h.current;return i.configure((0,o._)((0,r._)({dpr:window.devicePixelRatio,events:x.U3},s),{frameloop:"never",gl:(0,r._)({context:a,autoClear:!1,antialias:!0},null==s?void 0:s.gl),onCreated:e=>{var t;e.gl.forceContextLoss=()=>{},null===(t=s.onCreated)||void 0===t||t.call(s,e)},camera:{matrixAutoUpdate:!1,near:1,far:1e4},size:(0,r._)({width:e.clientWidth,height:e.clientHeight,top:e.offsetTop,left:e.offsetLeft,updateStyle:!1},null==s?void 0:s.size)})),{root:i,store:M.w.get(e).store}},[t,s]);(0,c.useEffect)(()=>{if(t&&t.style){let e=new m(t,f.getState().camera,a);u(e);let r=()=>D(t,e);return t.style.getOwnLayer(Z)||(t.style.loaded()?D(t,e):t.once("load",r)),t.on("style.load",r),()=>{u(null),t.off("load",r),t.off("style.load",r),t&&t.style&&t.style.getOwnLayer(Z)&&t.removeLayer(Z)}}},[t,f,a,u]);let _=j(()=>{var e;let a=t.getCanvas(),r=null===(e=M.w.get(a))||void 0===e?void 0:e.store;if(!r)return;let{setDpr:o,setSize:i}=r.getState();o(window.devicePixelRatio),i(a.clientWidth,a.clientHeight,!1,a.offsetTop,a.offsetLeft)});(0,c.useEffect)(()=>(d(f),()=>{d(null)}),[d,f]),(0,c.useEffect)(()=>(t.on("resize",_),()=>{t.off("resize",_)}),[]),(0,c.useEffect)(()=>{p.render((0,n.jsx)(n.Fragment,{children:l}))},[l])}((0,i._)(e,["map"]),t,E(e=>e.worldGroup)),null}function O(e){var{children:t}=e,a=(0,i._)(e,["children"]);let l=(0,c.useRef)(null),s=E(e=>e.worldGroup),[u]=(0,c.useState)(()=>new h.Vector3);return(0,M.A)(()=>{let e=l.current;if(!e)return;let t=s.matrix,a=t.elements,r=u.set(a[0],a[1],a[2]).length();0>t.determinant()&&(r=-r);let o=1/r;e.scale.setScalar(o)}),(0,n.jsx)("group",(0,o._)((0,r._)({ref:l},a),{children:t}))}var W=a(57547);(0,c.forwardRef)((e,t)=>{var{children:a,contexts:l=[]}=e,s=(0,i._)(e,["children","contexts"]);let c=(0,v.j)(...l),u=E(e=>e.htmlDivRef);return(null==u?void 0:u.current)!==null?(0,n.jsx)(W.V,(0,o._)((0,r._)({portal:u},s),{ref:t,children:(0,n.jsx)(c,{children:a})})):null}).displayName="Html";let A=(()=>{let e=new l.Point(0,0);return t=>{var a;let{pointer:r,mapboxMap:o}=t;e.x=r.x,e.y=r.y;let i=o.transform.pointCoordinate3D(e);return[i.toLngLat(),null!==(a=i.toAltitude())&&void 0!==a?a:null]}})();var z=a(70877),U=a(59361);let F="ThreeClickInterceptorPlane";function N(e){var t=(0,z._)({},(0,U._)(e));let a=(0,M.z)(e=>e.camera),o=(0,M.z)(e=>e.scene),i=(0,c.useMemo)(()=>{let e=new h.PlaneGeometry(1e3,1e3),t=new h.MeshBasicMaterial({transparent:!0,opacity:0,side:h.DoubleSide});return new h.Mesh(e,t)},[]);return(0,c.useEffect)(()=>{if(a)return a.add(i),o.add(a),i.position.set(0,0,-20),i.updateMatrix(),()=>{o.remove(a),a.remove(i)}},[a,o,i]),(0,n.jsx)("primitive",(0,r._)({object:i,name:F},t))}}}]);