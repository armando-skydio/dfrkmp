"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[96],{7028:function(e,t,a){a.d(t,{Html:function(){return d}});var r=a(6306),o=a(4921),n=a(566),i=a(4004),l=a(515),s=a(5180),c=a(4978),u=a(7232);let d=(0,c.forwardRef)((e,t)=>{var{children:a,contexts:c=[]}=e,d=(0,n._)(e,["children","contexts"]);let m=(0,l.j)(...c),h=(0,u.useNomadStore)(e=>e.htmlDivRef);return(null==h?void 0:h.current)!==null?(0,i.jsx)(s.V,(0,o._)((0,r._)({portal:h},d),{ref:t,children:(0,i.jsx)(m,{children:a})})):null});d.displayName="Html"},3034:function(e,t,a){a.d(t,{NomadMap:function(){return w}});var r=a(6306),o=a(4921),n=a(566),i=a(4004),l=a(515),s=a(961),c=a(601),u=a(4978),d=a(6447),m=a(9391),h=a(5937),p=a.n(h),f=a(8427),_=a(7232);a(1336);let v={initialViewState:{center:[-122.4194,37.7749],bearing:0,maxPitch:85,maxZoom:26,minPitch:0,minZoom:0,pitch:30,zoom:18},antialias:!1,attributionControl:!1,bearingSnap:1,bounds:void 0,boxZoom:!1,clickTolerance:1,collectResourceTiming:!1,crossSourceCollisions:!0,cooperativeGestures:!1,customAttribution:void 0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,hash:!1,fadeDuration:300,failIfMajorPerformanceCaveat:!1,fitBoundsOptions:void 0,interactive:!0,keyboard:!0,locale:void 0,localFontFamily:void 0,localIdeographFontFamily:void 0,logoPosition:"bottom-left",maxBounds:void 0,maxTileCacheSize:void 0,preserveDrawingBuffer:!1,projection:{name:"mercator",center:[0,0],parallels:[0,0]},pitchWithRotate:!0,refreshExpiredTiles:!0,renderWorldCopies:!0,scrollZoom:!0,style:"mapbox://styles/mapbox/light-v8",testMode:!1,trackResize:!0,transformRequest:void 0,touchZoomRotate:!0,touchPitch:!0,host:"https://api.mapbox.com"};function M(e){let t=(0,u.useRef)(null),a=(0,u.useRef)(),n=(0,u.useRef)(),l=(0,_.useNomadStore)(e=>e.setMapboxMap);return(0,u.useEffect)(()=>{if(!t.current)return;if(a.current){let t=a.current,{options:r,events:o}=x(e);for(let[e,a]of o)t.on(e,a);return n.current!=r.style&&(t.setStyle(r.style,{diff:!1,localFontFamily:void 0,localIdeographFontFamily:void 0}),n.current=r.style),function(e,t){for(let[o,n]of Object.entries(t)){if("style"===o)continue;let t="".concat(o.slice(0,1).toUpperCase()).concat(o.slice(1)),i="get".concat(t),l="set".concat(t);if(!(i in e))continue;let s=e[i]();if(s!==n){var a,r;if("center"===o&&Math.abs(s.lat-(null!==(a=n.lat)&&void 0!==a?a:n[1]))<=Number.MIN_VALUE&&Math.abs(s.lng-(null!==(r=n.lng)&&void 0!==r?r:n[0]))<=Number.MIN_VALUE||!(l in e))continue;e[l](n)}}}(t,r),()=>{for(let[e,a]of o)t.off(e,a)}}let{options:i,events:s,initialViewState:c}=x((0,r._)({},v,e));i.host&&(p().baseApiUrl=i.host,delete i.host);let u=new h.Map((0,o._)((0,r._)({},i,c),{container:t.current}));for(let[e,t]of(u.uuid=(0,f.Z)(),a.current=u,n.current=i.style,s))u.on(e,t);return l(u),()=>{for(let[e,t]of s)u.off(e,t)}},[e,t,l]),(0,u.useEffect)(()=>{let e;if(!(t.current&&a.current))return;let r=new ResizeObserver(()=>{clearTimeout(e),e=setTimeout(()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.resize()},50)});return r.observe(t.current),()=>{clearTimeout(e),r.disconnect()}},[t,a]),(0,u.useEffect)(()=>()=>{var e;null===(e=a.current)||void 0===e||e.remove(),a.current=void 0,l(null)},[]),(0,i.jsx)("div",{ref:t,style:{width:"100%",height:"100%"}})}function x(e){let t={},a=[],r={};for(let[n,i]of Object.entries(e)){var o;n.startsWith("on")&&n[2]===(null===(o=n[2])||void 0===o?void 0:o.toUpperCase())?a.push([n.slice(2,3).toLowerCase()+n.slice(3),i]):"initialViewState"===n&&"object"==typeof i?r=i:t[n]=i}return{options:t,events:a,initialViewState:r}}let S=e=>{let t=(0,u.useRef)(e);return t.current=e,(0,u.useCallback)(function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return t.current(...a)},[])};function w(e){var{children:t,accessToken:a,host:s,initialViewState:c,className:d,contexts:m=[],mapboxProps:h}=e,p=(0,n._)(e,["children","accessToken","host","initialViewState","className","contexts","mapboxProps"]);let f=(0,u.useRef)(null),v=(0,_.useNomadStore)(e=>e.htmlDivRef),x=(0,_.useNomadStore)(e=>e.setHtmlDivRef);(0,u.useEffect)(()=>{(null==v?void 0:v.current)==null&&f.current&&x(f)},[f,v,x]);let S=(0,_.useNomadStore)(e=>e.mapboxMap),w=(0,_.useNomadStore)(e=>e.mapboxLoaded),R=(0,_.useNomadStore)(e=>e.mapStyle),b=(0,_.useNomadStore)(e=>e.worldGroup),y=(0,_.useNomadStore)(e=>e._setMapboxLoaded),C=(0,_.useNomadStore)(e=>e._cleanup),E=(0,l.j)(_.po,...m);return(0,u.useEffect)(()=>()=>{C()},[C]),(0,i.jsx)("div",{ref:f,className:d,children:(0,i.jsxs)("div",{style:{height:"100%",width:"100%",position:"relative"},children:[(0,i.jsx)(M,(0,r._)({accessToken:a,host:s,style:R,initialViewState:c,antialias:!0,onLoad:e=>{y(!0)},dragPan:{easing:e=>0}},h)),S&&w&&(0,i.jsx)(g,(0,o._)((0,r._)({map:S},p),{children:(0,i.jsx)(E,{children:(0,i.jsx)("primitive",{object:b,children:t})})}))]})})}(0,s.e)(d);let R="mapboxSyncLayer",b=(e,t)=>{e.style.getOwnLayer(R)||e.addLayer({id:R,type:"custom",renderingMode:"3d",render:()=>{let t=e.getCanvas(),{gl:a,advance:r}=s.w.get(t).store.getState();a.resetState(),r(.001*Date.now(),!0),e.triggerRepaint()},prerender:()=>{t.update()}})};function g(e){var{map:t}=e;return!function(e,t,a){var{children:l}=e,d=(0,n._)(e,["children"]);let h=(0,_.useNomadStore)(e=>e._setCameraSync),p=(0,_.useNomadStore)(e=>e._setR3Fstate),f=(0,u.useRef)(null),{root:v,store:M}=(0,u.useMemo)(()=>{let e=t.getCanvas(),a=e.getContext("webgl2");f.current&&s.w.get(e)||(f.current=(0,s.b)(e));let n=f.current;return n.configure((0,o._)((0,r._)({dpr:window.devicePixelRatio,events:c.U3},d),{frameloop:"never",gl:(0,r._)({context:a,autoClear:!1,antialias:!0},null==d?void 0:d.gl),onCreated:e=>{var t;e.gl.forceContextLoss=()=>{},null===(t=d.onCreated)||void 0===t||t.call(d,e)},camera:{matrixAutoUpdate:!1,near:1,far:1e4},size:(0,r._)({width:e.clientWidth,height:e.clientHeight,top:e.offsetTop,left:e.offsetLeft,updateStyle:!1},null==d?void 0:d.size)})),{root:n,store:s.w.get(e).store}},[t,d]);(0,u.useEffect)(()=>{if(t&&t.style){let e=M.getState().camera,r=new m.V(t,e,a);h(r);let o=()=>b(t,r);return t.style.getOwnLayer(R)||(t.style.loaded()?b(t,r):t.once("load",o)),t.on("style.load",o),()=>{h(null),t.off("load",o),t.off("style.load",o),t&&t.style&&t.style.getOwnLayer(R)&&t.removeLayer(R)}}},[t,M,a,h]);let x=S(()=>{var e;let a=t.getCanvas(),r=null===(e=s.w.get(a))||void 0===e?void 0:e.store;if(!r)return;let{setDpr:o,setSize:n}=r.getState();o(window.devicePixelRatio),n(a.clientWidth,a.clientHeight,!1,a.offsetTop,a.offsetLeft)});(0,u.useEffect)(()=>(p(M),()=>{p(null)}),[p,M]),(0,u.useEffect)(()=>(t.on("resize",x),()=>{t.off("resize",x)}),[]),(0,u.useEffect)(()=>{v.render((0,i.jsx)(i.Fragment,{children:l}))},[l])}((0,n._)(e,["map"]),t,(0,_.useNomadStore)(e=>e.worldGroup)),null}},9391:function(e,t,a){a.d(t,{V:function(){return l},j:function(){return i}});var r=a(4246),o=a(6447);let n=Math.atan(3/4),i={WORLD_SIZE:1024e3,EARTH_CIRCUMFERENCE:2*Math.PI*6371008.8,FOV_ORTHO:.1/180*Math.PI,FOV:n,FOV_DEGREES:180*n/Math.PI,TILE_SIZE:512};class l{update(){let e=this.map.transform;this._camera.aspect=e.width/e.height;let t=e.centerOffset||new o.Vector3,a=0,n=0;this.halfFov=e._fov/2;let i=Math.PI/2+e._pitch,l=Math.cos(Math.PI/2-e._pitch);this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*e.height;let s=1,c=this.worldSize();s=this.mercatorZfromAltitude(1,e.center.lat)*c;let u=e._fov*(.5+e.centerOffset.y/e.height),d=e.elevation?e.elevation.getMinElevationBelowMSL()*s:0,m=(e._camera.position[2]*c-d)/Math.cos(e._pitch);a=Math.min(1.01*(Math.sin(u)*m/Math.sin((0,r.uZ)(Math.PI-i-u,.01,Math.PI-.01))*l+m),1/e._horizonShift*m),this.cameraTranslateZ.makeTranslation(0,0,this.cameraToCenterDistance);let h=e.height/50,p=e.height,f=e.width;this._camera.projectionMatrix=function(e,t,a,r){let n=new o.Matrix4,i=1/Math.tan(e/2),l=1/(a-r);return n.elements=[i/t,0,0,0,0,i,0,0,0,0,(r+a)*l,-1,0,0,2*r*a*l,0],n}(e._fov,f/p,Math.max(h*l,h),a),this._camera.projectionMatrix.elements[8]=-(2*t.x)/e.width,this._camera.projectionMatrix.elements[9]=2*t.y/e.height,this._camera.projectionMatrixInverse=this._camera.projectionMatrix.clone().invert();let _=this.calcCameraMatrix(e._pitch,e.angle,void 0,this._camera.matrix.identity());e.elevation&&(_.elements[14]=e._camera.position[2]*c),this._camera.updateMatrixWorld(!0);let v=e.scale*this._worldSizeRatio;this.__tempScaleMat.makeScale(v,v,v);let M=e.point.x,x=e.point.y;this.__tempTranslateMat.makeTranslation(-M,x,0),this.__tempRotateMat.makeRotationZ(Math.PI),this.__tempMatrix4.identity().premultiply(this.__tempRotateMat).premultiply(this.translateCenter).premultiply(this.__tempScaleMat).premultiply(this.__tempTranslateMat),this.world.matrix.copy(this.__tempMatrix4),this.world.updateMatrixWorld(!0)}worldSize(){let e=this.map.transform;return e.tileSize*e.scale}mercatorZfromAltitude(e,t){return e/this.circumferenceAtLatitude(t)}circumferenceAtLatitude(e){return i.EARTH_CIRCUMFERENCE*Math.cos(e*Math.PI/180)}calcCameraMatrix(e,t,a,r){let n=this.map.transform,i=void 0===e?n._pitch:e,l=void 0===t?n.angle:t,s=void 0===a?this.cameraTranslateZ:a;return(null!=r?r:new o.Matrix4).premultiply(s).premultiply(this.__tempRotateMat.makeRotationX(i)).premultiply(this.__tempScaleMat.makeRotationZ(l))}constructor(e,t,a){this.cameraTranslateZ=new o.Matrix4,this.__tempMatrix4=new o.Matrix4,this.__tempScaleMat=new o.Matrix4,this.__tempRotateMat=new o.Matrix4,this.__tempTranslateMat=new o.Matrix4,this.map=e,this._camera=t,this._camera.matrixAutoUpdate=!1,this._camera.matrixWorldAutoUpdate=!1,this.world=a||new o.Group,this.world.position.set(i.WORLD_SIZE/2,i.WORLD_SIZE/2,0),this.world.matrixAutoUpdate=!1,this.world.matrixWorldAutoUpdate=!1,this.translateCenter=new o.Matrix4().makeTranslation(i.WORLD_SIZE/2,-i.WORLD_SIZE/2,0),this._worldSizeRatio=i.TILE_SIZE/i.WORLD_SIZE,this.update()}}},7232:function(e,t,a){a.d(t,{NomadStoreProvider:function(){return p},po:function(){return m},useNomadStore:function(){return h}});var r=a(6306),o=a(4921),n=a(4004),i=a(4978),l=a(6447),s=a(612),c=a(3182);let u={perspective:{fov:50,pitch:45,canRotate:!0},orthographic:{fov:2.2,pitch:0,canRotate:!1}},d=e=>(0,s.Ue)()((0,c.XR)((t,a)=>{function n(){var t,a;let r=new l.Group;return r.name="World Group",r.matrixAutoUpdate=!1,{mapboxMap:null,threeStateRef:null,mapboxLoaded:!1,worldGroup:r,cameraSync:null,projectionMode:"perspective",mapStyle:null!==(t=e.mapStyle)&&void 0!==t?t:"mapbox://styles/mapbox/light-v10",htmlDivRef:null!==(a=e.htmlDivRef)&&void 0!==a?a:null}}return(0,o._)((0,r._)({},n()),{setMapboxMap:e=>t({mapboxMap:e}),setMapStyle:e=>t({mapStyle:e}),setHtmlDivRef:e=>t({htmlDivRef:e}),_setR3Fstate:e=>{t({threeStateRef:e});let r=a()._postSetupTask;null==r||r()},_setMapboxLoaded:e=>{t({mapboxLoaded:e});let r=a()._postSetupTask;null==r||r()},_setWorldGroup:e=>t({worldGroup:e}),setProjectionMode:e=>{var r;let o=a().mapboxMap;if(!o){console.warn("Map not loaded, cannot change projection mode");return}let n=null===(r=a().threeStateRef)||void 0===r?void 0:r.getState();if(!n){console.warn("Three state not loaded, cannot change projection mode");return}o.transform.fov=u[e].fov,n.camera.fov=u[e].fov,u[e].canRotate?(o.setMaxPitch(85),o.touchPitch.enable()):(o.setMaxPitch(0),o.touchPitch.disable()),o.setPitch(u[e].pitch),o.repaint=!0,o.transform._updateCameraOnTerrain(),t({projectionMode:e})},_setCameraSync:e=>t({cameraSync:e}),_postSetupTask:()=>{let r=a().mapboxMap,o=a().threeStateRef;r&&o&&(e.projectionMode&&a().setProjectionMode(e.projectionMode),t({_postSetupTask:null}))},_cleanup:()=>{t(n())},enableMapboxCameraMovement:e=>{let t=a().mapboxMap;if(!t){console.warn("Map not loaded, cannot enable/disable camera movement");return}let r=a().projectionMode;e?(t.dragPan.enable(),t.dragRotate.enable(),t.touchZoomRotate.enable(),u[r].canRotate?(t.setMaxPitch(85),t.touchPitch.enable()):(t.setMaxPitch(0),t.touchPitch.disable())):(t.dragPan.disable(),t.dragRotate.disable(),t.touchZoomRotate.disable(),t.touchPitch.disable())}})})),m=(0,i.createContext)(null);function h(e){let t=function(){let e=(0,i.useContext)(m);if(!e)throw Error("useNomadStoreInstance must be used within a NomadStoreProvider");return e}();return(0,s.oR)(t,e)}function p(e){let{children:t,initialStoreProps:a}=e,r=(0,i.useRef)();if(!r.current){let e=d(a);r.current=e,window.__DEV_GET_ZUSTAND_STORE_MAP=()=>e}return(0,n.jsx)(m.Provider,{value:r.current,children:t})}},5290:function(e,t,a){a.d(t,{ThreeClickInterceptor:function(){return d},threeClickInterceptorPlaneObject3DName:function(){return u}});var r=a(877),o=a(9361),n=a(6306),i=a(4004),l=a(961),s=a(4978),c=a(6447);let u="ThreeClickInterceptorPlane";function d(e){var t=(0,r._)({},(0,o._)(e));let a=(0,l.z)(e=>e.camera),d=(0,l.z)(e=>e.scene),m=(0,s.useMemo)(()=>{let e=new c.PlaneGeometry(1e3,1e3),t=new c.MeshBasicMaterial({transparent:!0,opacity:0,side:c.DoubleSide});return new c.Mesh(e,t)},[]);return(0,s.useEffect)(()=>{if(a)return a.add(m),d.add(a),m.position.set(0,0,-20),m.updateMatrix(),()=>{d.remove(a),a.remove(m)}},[a,d,m]),(0,i.jsx)("primitive",(0,n._)({object:m,name:u},t))}},9277:function(e,t,a){a.d(t,{ZoomInvariantGroup:function(){return d}});var r=a(6306),o=a(4921),n=a(566),i=a(4004),l=a(961),s=a(4978),c=a(6447),u=a(7232);function d(e){var{children:t}=e,a=(0,n._)(e,["children"]);let d=(0,s.useRef)(null),m=(0,u.useNomadStore)(e=>e.worldGroup),[h]=(0,s.useState)(()=>new c.Vector3);return(0,l.A)(()=>{let e=d.current;if(!e)return;let t=m.matrix,a=t.elements,r=h.set(a[0],a[1],a[2]).length();0>t.determinant()&&(r=-r);let o=1/r;e.scale.setScalar(o)}),(0,i.jsx)("group",(0,o._)((0,r._)({ref:d},a),{children:t}))}}}]);